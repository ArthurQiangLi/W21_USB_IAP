/**
  ******************************************************************************
  * @file    task_start.c
  * @author  SeanLi
  * @version 
  * @date    29-December-2017
  * @brief   
  *
  *                      
  ******************************************************************************
  * @attention
  *
  *
  ******************************************************************************
  */

/*******************************************************************************
************************************ Includes **********************************
*******************************************************************************/


#include "FreeRTOS.h"
#include "task.h"
#include "cmsis_os.h"

#include "task_start.h"
#include "msg_start.h"

#include "bsp_io.h"


/*******************************************************************************
******************************** Private typedef *******************************
*******************************************************************************/

/*******************************************************************************
******************************** Private define ********************************
*******************************************************************************/

/*******************************************************************************
********************************* Private macro ********************************
*******************************************************************************/

/*******************************************************************************
******************************* Private variables ******************************
*******************************************************************************/

QueueHandle_t		g_queue_start_led;
msg_start_led_t		s_msg_start_led;

/*******************************************************************************
************************** Private function prototypes *************************
*******************************************************************************/

/*******************************************************************************
******************************* Private functions ******************************
*******************************************************************************/



/*******************************************************************************
  * @brief  task_freertos_init
  *
  * @param  none
  *
  * @retval none
  *****************************************************************************/
void task_freertos_init(void)
{

}
	
/*******************************************************************************
  * @brief  task_start_creat_sem
  *
  * @param  none
  *
  * @retval none
  *****************************************************************************/
void task_start_creat_sem(void)
{
	g_queue_start_led = xQueueCreate(1, sizeof(msg_start_led_t));
}

/*******************************************************************************
  * @brief  start_app
  *
  * @param  none
  *
  * @retval none
  *****************************************************************************/
static void start_app(void)
{
	BaseType_t x_result;
	
	osDelay(20);
	x_result = xQueueReceive(g_queue_start_led, (void *)&s_msg_start_led, 0);
	x_result = x_result;
	//if(x_result == pdPASS){}	
	
	switch(s_msg_start_led){
		
		case MSG_START_LED_INIT:
			osDelay(50);
			bsp_io_led_wr(BSP_LED_RED, BSP_LED_TOG);
			bsp_io_led_wr(BSP_LED_GREEN, BSP_LED_OFF);
			break;
		
		case MSG_START_LED_FINISH:
			osDelay(480);
			bsp_io_led_wr(BSP_LED_RED, BSP_LED_TOG);
			bsp_io_led_wr(BSP_LED_GREEN, BSP_LED_OFF);
			break;
		
		case MSG_START_LED_ERROR:
		default:
			osDelay(480);
			bsp_io_led_wr(BSP_LED_RED, BSP_LED_TOG);
			bsp_io_led_wr(BSP_LED_GREEN, BSP_LED_ON);
			break;
	}
}

/*******************************************************************************
  * @brief  task_start
  *
  * @param  * argument
  *
  * @retval none
  *****************************************************************************/
void task_start(void const * argument)
{
	bsp_io_init();
	
	bsp_io_out_wr(BSP_OUT_PWR_ALL, BSP_SET);
	
	osDelay(10);

	for(;;){
		start_app();
	}
}


/********************************* end of file ********************************/
